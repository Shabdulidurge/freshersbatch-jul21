Type.registerNamespace("AppRealtimeChannel");AppRealtimeChannel.S=function(){};AppRealtimeChannel.ApiType=function(){};AppRealtimeChannel.ApiType.prototype={SendNotification:0,SendPersistentState:1,FindSession:2,Last:3};AppRealtimeChannel.ApiType.registerEnum("AppRealtimeChannel.ApiType",!1);AppRealtimeChannel.EventCountType=function(){};AppRealtimeChannel.EventCountType.prototype={AttemptCount:0,SuccessCount:1,DropCount:2,FailedCount:3,LatencyOverThresholdCount:4,LatencyUnderThresholdCount:5,ThrottledCount:6,Last:7};AppRealtimeChannel.EventCountType.registerEnum("AppRealtimeChannel.EventCountType",!1);AppRealtimeChannel.R=function(){};AppRealtimeChannel.d=function(){};AppRealtimeChannel.d.registerInterface("AppRealtimeChannel.d");AppRealtimeChannel.X=function(){};AppRealtimeChannel.V=function(){};AppRealtimeChannel.Y=function(){};AppRealtimeChannel.W=function(){};AppRealtimeChannel.Z=function(){};AppRealtimeChannel.U=function(){};AppRealtimeChannel.U.registerInterface("AppRealtimeChannel.U");AppRealtimeChannel.T=function(){};AppRealtimeChannel.ba=function(){};AppRealtimeChannel.ba.registerInterface("AppRealtimeChannel.ba");AppRealtimeChannel.A=function(){};AppRealtimeChannel.A.registerInterface("AppRealtimeChannel.A");AppRealtimeChannel.z=function(){};AppRealtimeChannel.z.registerInterface("AppRealtimeChannel.z");AppRealtimeChannel.bb=function(){};AppRealtimeChannel.bc=function(){};AppRealtimeChannel.Q=function(n){this.z=Function.createDelegate(this,this.C);this.A=Function.createDelegate(this,this.S);this.x=Function.createDelegate(this,this.R);this.y=Function.createDelegate(this,this.B);this.a=n;this.a.b(this.y)};AppRealtimeChannel.Q.prototype={a:null,i:null,g:0,f:!1,B:function(n,t){this.g=t.a},S:function(){Diag.a.a(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.a.a(null)},R:function(n){this.i.c(n)}};AppRealtimeChannel.k=function(n){this.k=Function.createDelegate(this,this.n);this.i=AppRealtimeChannel.k.b;this.g=AppRealtimeChannel.k.a;this.h=this.k;this.j=n};AppRealtimeChannel.k.b=function(n,t){return window.setTimeout(n,t)};AppRealtimeChannel.k.a=function(n){window.clearTimeout(n)};AppRealtimeChannel.k.prototype={d:!1,f:0,e:!1,j:null,i:null,g:null,h:null,a:function(){if(!this.d){var n=this;this.f=this.i(function(){n.d=!1;n.m()},8e3);this.d=!0;this.e=!1}},b:function(){this.l()},c:function(){this.m()},m:function(){(this.l(),this.e)||(this.e=!0,this.h())},n:function(){Diag.a.a(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.j)},l:function(){this.d&&this.g(this.f);this.f=0;this.d=!1}};AppRealtimeChannel.x=function(){};AppRealtimeChannel.x.prototype={i:0,h:0,g:0,f:0,c:!1,j:null,d:null,a:null,b:null,e:null,k:function(){return this.d+"?"+this.a}};AppRealtimeChannel.h=function(n,t,i,r,u,f,e,o,s,h,c,l,a){var y,v;this.E=Function.createDelegate(this,this.Z);this.D=Function.createDelegate(this,this.Y);this.F=Function.createDelegate(this,this.ba);this.z=new Date(0).getTime();this.I=["enabled","errorMessage","url","connectionString","queryString","throttling_globalMaxNumberOfOutstandingMessages","throttling_maxNumberOfOutstandingMessages","throttling_timeToWaitForResponse","throttling_messageDelay"];this.H=["enabled","errorMessage"];y=this;this.t=new AppRealtimeChannel.h.a(c?c:function(){return Common.a.i},u,f,e,n,t);this.j=l;this.v=r;this.l=t;this.y=i;this.g=o;this.n=s;this.m=a;this.u=!1;this.r=9e4;h&&(v=this,h.a(function(n){n.e(function(){Diag.a.a(40768456,500,50,"Connection parameters refresh requested for client [{0}]",v.g);v.t.d()})}));100*Math.random()<=2&&(this.w=3e5);AppRealtimeChannel.a.a&&(AppRealtimeChannel.a.a.j=this.w)};AppRealtimeChannel.h.d=function(n,t,i,r,u,f,e,o,s,h,c,l){return AppRealtimeChannel.h.e(n,t,i,r,u,f,e,o,s,h,null,c,l)};AppRealtimeChannel.h.e=function(n,t,i,r,u,f,e,o,s,h,c,l,a){n=n||Common.v.a().a;var v=new AppRealtimeChannel.h(n,t,i,r,u,f,e,o,s,h,c,l,a);return v.W(),v};AppRealtimeChannel.h.c=function(n,t,i){for(var u=i.$$lge(),r;u.$$mn();)r=u.$$cu(),r in t&&(n[r]=t[r])};AppRealtimeChannel.h.b=function(n,t){var f,h,e,i,r,u,o,s;if(n&&(f=n.indexOf("?"),-1!==f))for(h=n.substr(f+1),e=h.split("&"),i=0;i<e.length;++i)r=e[i].split("="),r.length===2&&(u=r[0],u&&u.length>0&&(o=0,s=r[1],s&&(o=s.length),t["q_"+u]=o))};AppRealtimeChannel.h.prototype={t:null,y:null,l:null,A:0,q:!1,v:null,n:null,g:null,B:null,w:36e5,o:1e3,p:0,m:null,u:!1,i:null,s:0,x:null,k:null,j:null,G:null,h:null,c:function(){return this.h},r:0,e:function(n){return this.r=n,n},f:function(n){this.k=n},W:function(){this.n.q(this.F);this.n.b(this.D)},Y:function(n,t){this.s=t.a;t.a===2&&(this.p=0)},a:function(n){return n.val=this.i.e,String.format("{0}&{1}={2}",this.i.a,"corrid",Common.d.b(n.val))},d:function(n,t,i,r,u){var f=this,e=this;this.bb(function(){r(u,"GetMachineIdSuccess")&&(Diag.a.a(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",f.h,f.g),n(f.B),i(f.U()))},function(n){r(u,"GetMachineIdFailure")&&(Diag.a.a(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",e.g),t(n))},r,u)},b:function(){this.J();this.V()},bb:function(n,t,i,r){if(Diag.a.a(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.h),this.h){n();return}var u=this.R(),f=this;window.setTimeout(function(){f.sendFindSessionRequestToServerInternal(n,t,i,r)},u)},sendFindSessionRequestToServerInternal:function(n,t,i,r){var f;if(i(r,"RequestMachineId")){this.z=(new Date).getTime();var e=Common.g.a(),u=this,o=this;this.L(function(t){var r=Common.g.a(),i;u.N(t);u.C();n();i=Common.g.a()-r;Diag.a.a(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",i)},function(n){var r=Common.g.a(),i;o.J();AppRealtimeChannel.a.a&&AppRealtimeChannel.a.a.a(2,3);t(n);i=Common.g.a()-r;Diag.a.a(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",i)},!1);f=Common.g.a()-e;Diag.a.a(577599296,345,50,"SFSRTS - TimeElapsed: {0}",f)}},V:function(){this.o+=3e3;this.o=Math.min(this.o,3e5)},R:function(){var t=(new Date).getTime(),n=this.z+this.o-t;return n<0&&(n=0),n},N:function(n){try{this.i=n;this.G=n.k();this.h=n.b;this.x=n.a;this.B=n.d}catch(t){Diag.a.a(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",t.toString())}},J:function(){this.h=null;this.K()},C:function(){this.K();this.q=!0;this.A=window.setTimeout(this.E,this.w)},K:function(){this.q&&(window.clearTimeout(this.A),this.q=!1)},Z:function(){this.q=!1;var n=this,t=this;this.L(function(t){var r=n.x!==t.a,i=n.h!==t.b,u=n.h;if(n.N(t),n.s){if(i){Diag.a.a(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",u||"null",t.b);n.n.a(null);return}n.n.F(r,i);n.C()}},function(){AppRealtimeChannel.a.a&&AppRealtimeChannel.a.a.a(2,3);t.C()},!0)},ba:function(){this.o=1e3},U:function(){return new AppRealtimeChannel.w(this.i.i,this.i.h,this.i.g,this.i.f)},bc:function(n){var t,i,r,f,u;if(Object.getType(n)!==Object)return null;t=n;i=t;for(r in i)f={key:r,value:i[r]};return u=this.S(t),u,u},S:function(n){var r,f,o,i,t;if(!("enabled"in n))return null;r=n.enabled;f=r?this.I:this.H;for(var e=f,s=e.length,u=0;u<s;++u)if(o=e[u],!(o in n))return null;return t=(i=new AppRealtimeChannel.x,i.c=n.enabled,i.j=n.errorMessage,i.e=Common.v.a().a,i),r&&(t.d=n.url,t.a=n.queryString,t.b=n.connectionString,t.f=n.throttling_globalMaxNumberOfOutstandingMessages,t.g=n.throttling_maxNumberOfOutstandingMessages,t.h=n.throttling_timeToWaitForResponse,t.i=n.throttling_messageDelay),t},T:function(n,t){Diag.a.a(50448152,500,50,"Using FindSessionUtils find session response");var i=this;this.m.a().CW(function(){var r=i.m.a().a();r?(Diag.a.a(50448153,500,50,"FindSessionUtils find Session resulted in success"),n(i.m.b())):(Diag.a.a(50448154,500,15,"FindSessionUtils find Session resulted in error"),t(i.m.b()))})},Q:function(n,t,i,r,u){var f=this;return function(e){var s,o;if(AppRealtimeChannel.b.a().d(0,1,!1),n&&n.a(),f.k=null,f.j=null,f.M(e.b,!0,t),s=AppRealtimeChannel.c.c(e.b.b,"FindSession",null,!0,8e3),s)if(o=f.bc(s),o){if(o.c&&o.a&&o.b){Diag.a.a(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",f.g);f.X(e.b);i(o);return}t.FindSessionFailureReason="FindSessionInvalidResponse";t.IsRtcEnabled=o.c;t.IsQueryStringEmpty=!o.a;t.IsConnectionStringEmpty=!o.b;Diag.a.a(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",f.g,o.c,!o.a,!o.b)}else t.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",Diag.a.a(8745097,500,15,"Could not translate server response to findSession response for [{0}]",f.g);else t.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",Diag.a.a(7372827,500,10,"Could not deserialize response data for [{0}]",f.g);f.O(t,u);r(null)}},P:function(n,t,i,r){var u=this;return function(f){var o;AppRealtimeChannel.b.a().d(0,1,!1);n&&n.a();u.k=null;u.j=null;u.M(f.b,!1,t);var s=null,h="unknown",e="unknown";f.b&&(o=f.b.d,o&&"RtcErrorCode"in o&&(s=o.RtcErrorCode.toString()),h=Common.bQ.toString(f.b.c),e=f.b.a.toString());t.FindSessionFailureReason="FindSessionRequestFailed";t.HttpErrorCode=e;t.HttpErrorStatus=h;t.RtcErrorCode=s;Diag.a.a(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",h,e,u.g,s,r);u.O(t,r);i(e)}},L:function(n,t,i){var e=null,u,f,o,r,s,h,c,l;if(Diag.a.a(4317445,500,50,"Getting MachineId from server for [{0}]",this.g),u={},f=this.t.e(),u["X-CorrelationId"]=Common.v.a().a,this.k&&this.k!==""?f=String.format("{0}&{1}={2}",f,"rr",this.k):this.j&&this.j!==""&&(f=String.format("{0}&{1}={2}",f,"rr",this.j),u["RTC-TokenProofkey"]="True",u["RTC-IsWacJsBootFsRequest"]="True"),o=this.y+"?"+f,i&&(u.FSType="polling"),r={},r.IsNetworkOfflineBeforeSendRequest=this.l.g(),r.HasAvailableConnectionsBeforeSendRequest=this.l.t(),r.MaxConnectionsAllowed=this.l.m(),r.IsRefreshMachineId=i,this.m&&!this.u){s=this.Q(null,r,n,t,i);h=this.P(null,r,t,i);this.T(s,h);this.u=!0;return}this.v&&(e=this.v.a("WebServiceCall","GetMachineIdFromTheServer"));AppRealtimeChannel.a.a&&AppRealtimeChannel.a.a.a(2,0);AppRealtimeChannel.b.a().d(0,0,!1);c=this.l.d(o,1,null,u,["RtcErrorCode","X-OfficeCluster","X-NewEnv"],!1,1,this.Q(e,r,n,t,i),this.P(e,r,t,i),null,null,!1,null,this.r,"3",null,!0,null,!1,null,null);c<0&&(this.p>5&&this.p<200&&Diag.a.a(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.p),l=this,window.setTimeout(function(){l.p++;t("-1")},1e3))},M:function(n,t,i){i||(i={});i.IsNetworkOfflineAfterRequestComplete=this.l.g();i.IsRequestSucceeded=t;n&&(i.EnqueueTime=n.p,i.InvokedTime=n.h,i.CompletedTime=n.i,n.d&&("X-CorrelationId"in n.d&&(i.CorrelationId=n.d["X-CorrelationId"]),"X-OfficeCluster"in n.d&&(i["X-OfficeCluster"]=n.d["X-OfficeCluster"])));Diag.a.a(38633565,500,t?50:15,AppRealtimeChannel.c.a(i))},O:function(n,t){n||(n={});n.ConnectionState=Common.dW.toString(this.s);t||this.n.f(1,n)},X:function(n){var o,r,s,t,y,h,c,u,f,l,i,p,w;try{var a=!1,v=!1,e=n.d;if(e&&"X-NewEnv"in e&&(o=e["X-NewEnv"].toString().toLocaleLowerCase(),v=o==="true",a=o==="false"),r=!1,s=n.e.get_url().toLocaleLowerCase().indexOf("collab")>=0,v&&!s?r=!0:a&&s&&(r=!0),!r)return;t={};y=Common.k.g(n.e.get_url());t.HostName=y;t.Status=Common.bQ.toString(n.c);t.HttpStatus=n.a.toString();h=n.e.get_headers();for(c in h)u={key:c,value:h[c]},f=u.key,f&&f.length>0&&(l=0,u.value&&(l=u.value.toString().length),t["r_"+f]=l);n.d&&(p=(i=new($$sc.v.$$(String)),i.b("X-CorrelationId"),i.b("X-OfficeCluster"),i.b("RtcErrorCode"),i.b("X-OfficeFE"),i.b("X-OFFICEFD"),i.b("X-MSEdge-Ref"),i),AppRealtimeChannel.h.c(t,n.d,p));AppRealtimeChannel.h.b(n.e.get_url(),t);w=Common.H.b(t);Diag.a.a(559437006,500,15,w)}catch(b){Diag.a.a(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",b.toString())}}};AppRealtimeChannel.h.a=function(n,t,i,r,u,f){var e,o;this.c=n;e=String.format("{0}={1}","ClientId",Common.d.b(r));e=String.format("{0}&{1}={2}",e,"usid",Common.d.b(u));e=String.format("{0}&{1}={2}",e,"UserApp",Common.d.b(i.toString()));e=String.format("{0}&{1}={2}",e,"UserType",Common.d.b(1..toString()));e=String.format("{0}&{1}={2}",e,"UserVersion",Common.d.b(t));e=String.format("{0}&{1}={2}",e,"clientProtocol",Common.d.b("1.0"));o=AppRealtimeChannel.h.a.a(i,f);o&&(e=String.format("{0}&{1}",e,o));this.b=e};AppRealtimeChannel.h.a.a=function(n,t){return n===4?String.format("{0}={1}","NoAuth","1"):t?t.x():null};AppRealtimeChannel.h.a.prototype={a:null,c:null,b:null,d:function(){this.a=this.c()},e:function(){this.a&&this.a!==""||(this.d(),Diag.a.a(575784194,500,!this.a||this.a===""?15:50,"Query signature delegate called for refresh returned: {0} ",this.a));var n=String.format("{0}={1}","qs",Common.d.b(this.a));return String.format("{0}&{1}",n,this.b)}};AppRealtimeChannel.a=function(n){this.n=Function.createDelegate(this,this.o);this.l=n;this.q();this.e=!1;this.f=!1;this.c=!1;this.d=0};AppRealtimeChannel.a.b=function(n){return AppRealtimeChannel.a.a||(AppRealtimeChannel.a.a=new AppRealtimeChannel.a(n)),AppRealtimeChannel.a.a};AppRealtimeChannel.a.prototype={c:!1,i:null,h:null,j:0,k:0,b:null,l:null,e:!1,f:!1,g:0,m:0,d:0,t:function(n){this.m=n;window.setInterval(this.n,n);this.g=(new Date).getTime()},a:function(n,t){(!this.s(n)||this.f)&&(this.c||window.navigator.onLine&&!this.l.g()&&(this.b[n][t]++,this.e=!0))},q:function(){var n,t;for(this.b=new Array(3),n=0;n<3;n++)for(this.b[n]=new Array(7),t=0;t<7;t++)this.b[n][t]=0},p:function(){for(var t,r,n={},i=0;i<3;i++)for(t=0;t<7;t++)this.r(i,t)&&(r=AppRealtimeChannel.ApiType.toString(i)+AppRealtimeChannel.EventCountType.toString(t),n[r]=this.b[i][t]);return n.FSDomain=this.i,n.ConnectionDomain=this.h,n.FSRetryInterval=this.j,n.MaxPayloadSize=this.k,n.LogNumber=this.d,this.d===1&&(n.FSLatencies=AppRealtimeChannel.b.a().m(),n.ConLatencies=AppRealtimeChannel.b.a().l()),n},r:function(n,t){return n===2&&t!==3&&t?!1:!0},s:function(n){return n===2?!1:!0},o:function(){var i,r,n,t;if(this.e){for(this.d++,i=(new Date).getTime(),i-this.g<5e3+this.m&&(r=Common.H.b(this.p()),Diag.a.a(50644352,500,15,r)),this.g=(new Date).getTime(),n=0;n<3;n++)for(t=0;t<7;t++)this.b[n][t]=0;this.e=!1}}};AppRealtimeChannel.n=function(n,t,i,r,u,f,e,o,s,h,c,l){this.Q=Function.createDelegate(this,this.bh);this.Z=Function.createDelegate(this,this.be);this.L=Function.createDelegate(this,this.bf);this.T=Function.createDelegate(this,this.bd);this.R=Function.createDelegate(this,this.bi);this.V=Function.createDelegate(this,this.bs);this.U=Function.createDelegate(this,this.br);this.W=Function.createDelegate(this,this.bt);this.ba=Function.createDelegate(this,this.by);this.X=Function.createDelegate(this,this.bu);this.Y=Function.createDelegate(this,this.bv);this.S=Function.createDelegate(this,this.J);this.t=new($$sc.w.$$($$sc.r.$$(AppRealtimeChannel.m,AppRealtimeChannel.n.b)));this.H=new Date(0).getTime();this.z=n;this.F=t;this.u=0;this.E=r;this.G=o;this.B=e;this.s=s;this.O=u;this.A=f;this.w=i;this.y=h;this.C=c;this.N=l;this.M=Math.random()*100<1};AppRealtimeChannel.n.c=function(n,t,i,r,u,f,e,o,s,h,c,l,a){return AppRealtimeChannel.n.a.b(n,t,i,a,r,u,f,e,o,s,h,l,c)};AppRealtimeChannel.n.prototype={z:null,I:!1,x:null,u:0,C:null,O:null,D:1,v:null,F:null,E:null,P:0,G:null,A:null,B:null,w:null,y:null,N:null,s:null,bo:function(){this.s.o(this.S);this.s.v(this.Y);this.s.u(this.X);this.N.i(this.y);var n=this;Common.a.cp(function(){n.y.j();AppRealtimeChannel.a.a&&AppRealtimeChannel.a.a.o()});this.bc();this.bk();this.s.t(this.ba)},bk:function(){var n,i,r,t;try{if(n=$.signalR,!n)throw Error.invalidOperation("Failed to retrieve Signalr object");if(i=n.version,!i)throw Error.invalidOperation("Signalr object is missing version information");if(i!=="2.1.1")return;if(r=n.transports,!r)throw Error.invalidOperation("Failed to retrieve transports object");if(t=r.longPolling,!t)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!t.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");t.supportsKeepAlive=this.bj()}catch(u){Diag.a.a(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",u.message)}},bj:function(){var n=this;return function(){return!1}},bc:function(){var t=++this.D,n;this.H=new Date(0).getTime();this.v=this.O();this.s.D(this.v);n=this;this.v.stateChanged(function(i){n.bq(i,t)});this.v.connectionSlow(this.W);this.v.error(this.U);this.v.log=this.V},bf:function(n,t){return n!==this.D?(Diag.a.a(4309017,500,50,"ConnectionToken verification failed for {0}",t),!1):!0},l:function(){this.u!==2&&this.u!==1&&(Diag.a.a(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.w),this.G.a(),AppRealtimeChannel.b.a().n(),this.K(1,this.u),this.be())},be:function(){var n=this.D;this.I=!1;this.y.d();this.A.d(this.R,this.T,this.B.x,this.L,n)},bd:function(n){this.y.f();var t=null;n&&((t=n.toLowerCase())==="documentsessiondeleted"||t==="documentsessionexpired")?(Diag.a.a(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.w,n),this.m()):this.J(null,null)},J:function(n,t){var i,r,u;Diag.a.a(4309018,500,50,"Disconnecting the connection [{0}]",this.x);i=this.u===2||this.u===1;i=i&&!this.B.f;r=!0;u=0;t&&Object.getType(t)!==Object.getType(Sys.EventArgs.Empty)&&t.a&&t.a!==""&&(i=!0,this.A.f(t.a),r=t.d,u=t.b);i&&this.K(1,this.u);++this.D;this.B.D();this.bx(r);this.A.b();this.bc();i&&window.setTimeout(this.Z,Math.min(u,3e4))},by:function(){var n=null,t,i,r=(i=this.A.a(t={val:n}),n=t.val,i);this.v.qs=r;Diag.a.a(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.w,n)},bi:function(n){var t,f,e,u,r;this.H=(new Date).getTime();t=null;this.v.qs=(e=this.A.a(f={val:t}),t=f.val,e);this.C.e()&&(this.v.url=n,AppRealtimeChannel.a.a&&(AppRealtimeChannel.a.a.h=Common.k.g(n)));u=null;this.E&&(u=this.E.a("WebServiceCall","ConnectToServer"));Diag.a.a(3290048,500,50,"Connecting to server for client [{0}]",this.w);r={};this.F&&(r.transport=this.F.length===1?this.F[0]:this.F);r.pingInterval=null;AppRealtimeChannel.b.a().d(1,0,!1);r.waitForPageLoad=!1;var o=this,i=this,s=this;this.v.start(r,null).done(function(n){o.y.g();AppRealtimeChannel.b.a().d(1,1,!0);Diag.a.a(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",n.id,t)}).fail(function(n){Diag.a.a(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1}, callback parameter:{2} for [{3}]",i.A.c(),t,AppRealtimeChannel.c.a(n),i.w);i.bd(null);i.y.e(n);AppRealtimeChannel.b.a().d(1,1,!1);i.s.f(0,{CorrelationId:t,ErrorDetails:n,ConnectionState:Common.dW.toString(i.u)})}).always(function(){u&&u.a();AppRealtimeChannel.a.a&&(AppRealtimeChannel.a.a.c=!1)})},m:function(){if(!this.u){Diag.a.a(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.w);return}this.y.h();AppRealtimeChannel.a.a&&(AppRealtimeChannel.a.a.c=!0);Diag.a.a(36545633,500,50,"Starting explicit disconnect for [{0}]",this.w);this.B.f=!0;this.G.b();this.K(0,this.u);this.J(null,null);this.B.f=!1},bx:function(n){var t=this.bg(),f=this.v,i=this.x,r=this,u=function(){if(r.I)Diag.a.a(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{r.I=!0;f.stop(!0,n)}catch(t){Diag.a.a(591692191,500,15,"Stopping connection failed: {0}",t.message)}};t>0?(Diag.a.a(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",i,t),window.setTimeout(u,t)):(Diag.a.a(36804372,500,50,"Stopping connection [{0}].",i),u())},bg:function(){var n=0;return this.v.state||(n=this.H+15e3-(new Date).getTime(),n<0&&(n=0)),n},g:function(){return this.u},e:function(n){this.s.b(n)},h:function(n){this.s.I(n)},r:function(n){return this.bw(0,n)},bw:function(n,t){var i=new($$sc.D.$$(Object));return this.s.g(n,t,i),i.a},f:function(n){this.s.m(n)},i:function(n){this.s.J(n)},n:function(n){return this.t.c(n)&&this.t.b(n).c(0)?this.t.b(n).b(0).a:null},p:function(){return this.bm(0)},bm:function(n){for(var i={},r=this.t.$$ge(),t;r.$$mn();)t=r.$$cu(),t.a.c(n)&&(i[t.b]=t.a.b(n).a);return i},bv:function(n,t){for(var u=t.b.$$ge(),i,r;u.$$mn();)i=u.$$cu(),this.t.c(i.b)||this.t.a(i.b,new($$sc.r.$$(AppRealtimeChannel.m,AppRealtimeChannel.n.b))),r=i.a,this.t.b(i.b).a(t.a,new AppRealtimeChannel.n.b(r.Presence,new Date(r.TimeStamp))),i.b!==this.z||t.a||this.s.z(r.Presence)},bu:function(n,t){for(var u,r=t.a,f=r.length,i=0;i<f;++i)u=r[i],this.t.d(u)},bl:function(){var n=new($$sc.r.$$(AppRealtimeChannel.m,Object)),t,i;if(!this.t.c(this.z))return n;for(t=this.t.b(this.z).$$ge();t.$$mn();)i=t.$$cu(),n.a(i.b,i.a.a);return n},k:function(n,t,i){var r=new($$sc.D.$$(Object));return this.s.c(n,t,i,r),r.a},a:function(n){this.s.d(n)},j:function(n){this.s.K(n)},o:function(n){var i,t,r,u,f,e;return!(u=this.t.f(n,r={val:i},null),i=r.val,u)||!(e=i.e(0,f={val:t},null),t=f.val,e)?null:new Common.iy(this.bn(t),t.b)},q:function(){for(var t={},i=this.t.$$ge(),n,r,u,f;i.$$mn();)n=i.$$cu(),(f=n.a.e(0,u={val:r},null),r=u.val,f)&&(t[n.b]=this.o(n.b));return t},b:function(){return this.z},M:!1,bq:function(n,t){this.bf(t,"StateChangedSignalR")&&this.K(this.bb(n.newState),this.bb(n.oldState))},K:function(n,t){var r,i,u,f,e;if((this.u!==1||t||n!==1)&&this.u!==t&&(r=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.u,t,n])),Diag.a.a(3290053,500,10,r)),this.u!==n){switch(n){case 2:AppRealtimeChannel.a.a&&(AppRealtimeChannel.a.a.f=!0);this.x=this.v.id;Diag.a.a(3249539,500,50,"Established connection [{0}] for client [{1}]",this.x,this.w);this.bp(this.v);Diag.a.a(4298369,500,50,"Retrieving complete session state");i=null;this.E&&(i=this.E.a("WebServiceCall","Receive First Presence"));u=this.D;this.s.C(this.L,u,this.G,this.Q,this.bl(),i);this.C.k()&&(f=100*Math.random()<=this.C.l(),e=AppRealtimeChannel.e.b(this.s,this.C,f),e.n());break;case 1:t===2&&Diag.a.a(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.x);break;case 0:if(AppRealtimeChannel.e.a&&AppRealtimeChannel.e.a.o(),this.B.f)Diag.a.a(3249543,500,50,"Connection [{0}] has been explicitly closed",this.x);else{t===1&&(Diag.a.a(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.x),this.y.i());t===2&&Diag.a.a(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.x);this.J(null,null);return}}this.u=n;this.s.w(n,t)}},bp:function(n){if(!n||!n.transport||!n.transport.name){Diag.a.a(4290722,500,10,"Transport protocol name is missing");return}var t=n.transport.name,i=t.toLowerCase(),r="Transport name - {0} for [{1}]";i==="websockets"?Diag.a.a(4290723,500,50,r,t,this.w):i==="serversentevents"?Diag.a.a(4290752,500,50,r,t,this.w):i==="foreverframe"?Diag.a.a(4290753,500,50,r,t,this.w):i==="longpolling"?Diag.a.a(4290754,500,50,r,t,this.w):i==="mocktransport"||Diag.a.a(4290755,500,15,"Unknown transport protocol encountered - '{0}'",t)},bt:function(){Diag.a.a(3249544,500,50,"Detected that the connection [{0}] is slow",this.x)},br:function(n){Diag.a.a(3249545,600,10,"SignalR ERROR for connection [{0}]: {1}",this.x,AppRealtimeChannel.c.a(n)||"<empty>")},bs:function(n){var t=AppRealtimeChannel.c.a(n);this.M&&this.P<2e3&&!t.startsWith("Invok")&&!t.startsWith("Trigger")&&(Diag.a.a(578950464,500,50,"SignalR lib: {0}",t),this.P++)},bh:function(){var n,t=new Array(0),u,f,i,e,s;for((f=this.t.f(this.z,u={val:n},null),n=u.val,f)&&this.t.d(this.z),i=this.t.i().$$ge();i.$$mn();)e=i.$$cu(),Array.add(t,e);for(var o=t,h=o.length,r=0;r<h;++r)s=o[r],this.t.d(s);n&&this.t.a(this.z,n);this.s.y(t)},bb:function(n){switch(n){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",n,"Unknown SignalR state");}},bn:function(n){if(!n||!n.b)return 1;var t=new Date;return t.getTime()-n.b.getTime()>(this.C.g()?6e4:this.C.f())?2:1}};AppRealtimeChannel.n.b=function(n,t){this.a=n;this.b=t};AppRealtimeChannel.n.b.prototype={a:null,b:null};AppRealtimeChannel.n.a=function(){};AppRealtimeChannel.n.a.b=function(n,t,i,r,u,f,e,o,s,h,c,l){var a=AppRealtimeChannel.o.a(Common.a.a),b=Common.a.m?Common.a.m:"1.0",v=AppRealtimeChannel.n.a.c(n,t,e,b),k=a.h()?AppRealtimeChannel.f.b(v):new AppRealtimeChannel.C,p=AppRealtimeChannel.a.b(u),y,w,d;a.m()&&p.t(a.n());y="";y=s&&s!==""?s:"/rtc2/";p.i=Common.k.g(y);var nt=y+"signalr",tt=y+"findsession",it="realtimeChannelHub",rt=new AppRealtimeChannel.M,ut=function(){return $.hubConnection(nt)},ft=function(n){return new AppRealtimeChannel.D(n.createHubProxy(it))};c=c||AppRealtimeChannel.g.b();Diag.a.b(556867617,500,a.c()<=31e3,"Client attempting to override max payload size beyond absolute limit");w=Math.min(a.c(),31e3);p.k=w;d=new AppRealtimeChannel.I(a,new AppRealtimeChannel.N(rt),n,v,ft,o,c,k,p,w);h||(h=AppRealtimeChannel.h.d(t,u,tt,o,b,e,n,v,c,f,r,l));h.e(a.i());var et=new AppRealtimeChannel.k(v),ot=i?i.split(","):null,g=new AppRealtimeChannel.n(n,ot,v,o,ut,h,d,et,c,k,a,u);return g.bo(),g};AppRealtimeChannel.n.a.c=function(n,t,i){return String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",n,AppRealtimeChannel.n.a.a(AppRealtimeChannel.s.toString(i)),AppRealtimeChannel.n.a.a(AppRealtimeChannel.t.toString(1)),t)};AppRealtimeChannel.n.a.a=function(n){return n?n.charAt(0).toLocaleUpperCase()+n.substring(1,n.length):n};AppRealtimeChannel.f=function(){};AppRealtimeChannel.f.b=function(n){return AppRealtimeChannel.f.a||(AppRealtimeChannel.f.a=new AppRealtimeChannel.f,Diag.a.a(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",n)),AppRealtimeChannel.f.a};AppRealtimeChannel.f.prototype={B:0,s:0,G:0,E:0,F:0,J:0,I:0,H:0,n:null,t:null,v:null,o:null,p:null,m:null,w:null,y:null,x:null,q:null,z:null,u:null,C:0,K:0,r:0,A:0,d:function(){this.B++;this.v=new Date;this.n||(this.n=new Date)},g:function(){this.s++;this.m=new Date;this.t||(this.t=this.m);this.q=this.m;this.M()},f:function(){this.G++;this.w=new Date},i:function(){this.E++;this.o=new Date},h:function(){this.F++;this.p=new Date},c:function(){this.y=new Date;this.J++},b:function(){this.u||(this.u=new Date);this.I++},a:function(){this.x=new Date;this.H++},D:!1,j:function(){if(!this.D&&this.B){var n=this.L();Diag.a.a(39321871,500,15,Common.H.b(n));this.D=!0}},e:function(n){var t,i,r,u,f,e;AppRealtimeChannel.c.d(n,u={val:t},f={val:i},e={val:r});t=u.val;i=f.val;r=e.val;t&&t!==200&&(Diag.a.a(40157596,500,15,Common.H.b({HttpErrorCode:t,HttpErrorStatus:i,Exception:r})),t>=400&&t<=499&&this.C++,t>=500&&t<=599&&this.K++)},k:function(){this.z=new Date},l:function(){this.q=new Date;this.o=this.q},L:function(){return{numberOfConnectionAttempts:this.B,numberOfSuccessfulConnections:this.s,numberOfFailedConnections:this.G,numberOfDisconnectedConnections:this.E,numberOfExplicitDisconnectedConnections:this.F,numberOfSentMessages:this.J,numberOfReceivedMessages:this.I,numberOfLostMessages:this.H,firstConnectionAttempt:this.n?this.n:null,firstMessageReceived:this.u?this.u:null,firstConnectionSuccess:this.t?this.t:null,lastConnectionAttempt:this.v?this.v:null,lastConnectionSuccess:this.m?this.m:null,lastConnectionFailure:this.w?this.w:null,lastMessageSent:this.y?this.y:null,lastMessageLost:this.x?this.x:null,lastDisconnect:this.o?this.o:null,lastExplicitDisconnect:this.p?this.p:null,lastTimeOnline:this.q?this.q:null,lastTimeOffline:this.z?this.z:null,maxDisconnectedTimeMs:this.r,maxExplicitDisconnectedTimeMs:this.A,clientConnectionErrors:this.C,serverConnectionErrors:this.K}},M:function(){this.n&&this.s===1&&(this.r=Math.max(this.r,this.m.getTime()-this.n.getTime()));this.o&&this.s>1&&(this.r=Math.max(this.r,this.m.getTime()-this.o.getTime()));this.p&&this.s>1&&(this.A=Math.max(this.A,this.m.getTime()-this.p.getTime()))}};AppRealtimeChannel.C=function(){};AppRealtimeChannel.C.prototype={d:function(){},g:function(){},f:function(){},i:function(){},h:function(){},c:function(){},b:function(){},a:function(){},j:function(){},e:function(){},k:function(){},l:function(){}};AppRealtimeChannel.D=function(n){this.l=n};AppRealtimeChannel.D.prototype={l:null,c:function(n){this.l.on("presenceUpdated",n)},d:function(n){this.l.on("updateNotification",n)},b:function(n){this.l.on("persistentStateUpdated",n)},a:function(n){this.l.on("persistentStateCleared",n)},g:function(n){this.l.off("presenceUpdated",n)},h:function(n){this.l.off("updateNotification",n)},f:function(n){this.l.off("persistentStateUpdated",n)},e:function(n){this.l.off("persistentStateCleared",n)},j:function(n,t){return this.l.invoke("SendUpdateNotification",n,t)},i:function(n){return this.l.invoke("GetCompletePersistentStateWithMetadata",n)},k:function(n,t){return this.l.invoke("UpdatePersistentState",n,t)}};AppRealtimeChannel.o=function(){};AppRealtimeChannel.o.a=function(n){var i,t;return n?(t=new AppRealtimeChannel.o,t.D=n.a("AwayStatusManagerIsEnabled"),t.s=n.a("AwayStatusOneMinuteTimeoutIsEnabled"),t.r=n.c("AwayCoauthorThresholdMs",9e5),t.q=n.a("RtcAllowCrossDomainAccessEnabled"),t.v=n.a("RTCLogUpdateNotificationHintOnDeserializationFailure"),t.B=n.a("ShouldLogOnContentNotification"),t.C=n.a("ShouldLogOnHostSubscriptionNotification"),t.t=n.a("RtcClientMetricsEnabled"),t.u=n.c("RtcFindSessionRequestTimeoutInMS",6e4),t.E=n.a("RtcJsClientFrequentlyLogsMetrics"),t.F=n.c("RtcJsClientFrequentMetricsLatencyThresholdInMS",1e3),t.G=n.c("RtcJsClientFrequentMetricsLogIntervalInMS",3e5),t.w=n.a("RtcClientMessageTelemetryEnabled"),t.x=n.c("RtcClientMessageTelemetrySampleSize",5),t.A=n.c("RtcSendTelemetryMessageIntervalInMS",3e5),t.y=n.c("RtcLogClientMessageMetricsTimeOutInMs",2e4),t.z=n.c("RtcMaxPayloadSizeInCharactersOverride",8e3),t):(i=new AppRealtimeChannel.o,i.D=!1,i.s=!1,i.r=9e5,i.q=!1,i.v=!0,i.B=!1,i.C=!0,i.t=!1,i.u=9e4,i.w=!1,i.x=5,i.A=3e5,i.y=2e4,i.z=8e3,i)};AppRealtimeChannel.o.prototype={D:!1,s:!1,g:function(){return this.s},r:0,f:function(){return this.r},q:!1,e:function(){return this.q},v:!1,j:function(){return this.v},B:!1,o:function(){return this.B},C:!1,p:function(){return this.C},t:!1,h:function(){return this.t},u:0,i:function(){return this.u},E:!1,m:function(){return this.E},F:0,a:function(){return this.F},G:0,n:function(){return this.G},w:!1,k:function(){return this.w},x:0,l:function(){return this.x},A:0,d:function(){return this.A},y:0,b:function(){return this.y},z:0,c:function(){return this.z}};AppRealtimeChannel.g=function(){this.L=new Common.bc};AppRealtimeChannel.g.b=function(){return AppRealtimeChannel.g.a||(AppRealtimeChannel.g.a=new AppRealtimeChannel.g)};AppRealtimeChannel.g.prototype={L:null,w:function(n,t){this.L.k("CSC",new Common.gM(n,t),null)},D:function(n){this.L.k("RP",new AppRealtimeChannel.G(n),null)},a:function(n){this.L.k("RC",n,null)},E:function(){this.L.k("RMID",null,null)},C:function(n,t,i,r,u,f){this.L.k("RPS",new AppRealtimeChannel.E(n,t,i,r,u,f),null)},h:function(n,t){this.L.k("UPSR",new AppRealtimeChannel.P(n,t),null)},e:function(n,t){this.L.k("PU",new Common.gc(n,t),null)},z:function(n){this.L.k("MPU",new Common.hJ(n),null)},c:function(n,t,i,r){return this.L.k("SUN",new AppRealtimeChannel.u(n,t,i,r),null)},G:function(n,t){this.L.k("UNR",new Common.ix(n,t),null)},g:function(n,t,i){return this.L.k("SP",new AppRealtimeChannel.J(n,t,i),null)},B:function(n,t){this.L.k("PSU",new Common.hX(n,t),null)},A:function(n){this.L.k("PSC",new Common.gb(n),null)},y:function(n){this.L.k("IPSC",new Common.gb(n),null)},H:function(n){this.L.k("UPSC",new AppRealtimeChannel.O(n),null)},F:function(n,t){this.L.k("SPC",new AppRealtimeChannel.K(n,t),null)},f:function(n,t){this.L.k("RCF",new AppRealtimeChannel.H(n,t),null)},x:function(n){this.L.k("CPSWM",new AppRealtimeChannel.y(n),null)},b:function(n){this.L.m("CSC",n)},I:function(n){this.L.n("CSC",n)},p:function(n){this.L.m("RP",n)},o:function(n){this.L.m("RC",n)},q:function(n){this.L.m("RMID",n)},n:function(n){this.L.m("RPS",n)},v:function(n){this.L.m("UPSR",n)},m:function(n){this.L.m("PU",n)},J:function(n){this.L.n("PU",n)},k:function(n){this.L.m("IPU",n)},s:function(n){this.L.m("SUN",n)},l:function(n){this.L.m("IUNR",n)},d:function(n){this.L.m("UNR",n)},K:function(n){this.L.n("UNR",n)},j:function(n){this.L.m("IPSU",n)},i:function(n){this.L.m("IPSC",n)},u:function(n){this.L.m("UPSC",n)},r:function(n){this.L.m("SP",n)},t:function(n){this.L.m("SPC",n)}};AppRealtimeChannel.J=function(n,t,i){AppRealtimeChannel.J.initializeBase(this);this.a=n;this.b=t;this.c=i};AppRealtimeChannel.J.prototype={a:0,b:null,c:null};AppRealtimeChannel.u=function(n,t,i,r){AppRealtimeChannel.u.initializeBase(this);this.c=n;this.d=t;this.a=i;this.b=r};AppRealtimeChannel.u.prototype={c:0,d:null,a:!1,b:null};AppRealtimeChannel.G=function(n){AppRealtimeChannel.G.initializeBase(this);this.a=n};AppRealtimeChannel.G.prototype={a:null};AppRealtimeChannel.E=function(n,t,i,r,u,f){AppRealtimeChannel.E.initializeBase(this);this.d=n;this.a=t;this.f=i;this.b=u;this.e=r;this.c=f};AppRealtimeChannel.E.prototype={c:null,b:null,e:null,f:null,a:0,d:null};AppRealtimeChannel.P=function(n,t){AppRealtimeChannel.P.initializeBase(this);this.a=n;this.b=t};AppRealtimeChannel.P.prototype={a:0,b:null};AppRealtimeChannel.O=function(n){AppRealtimeChannel.O.initializeBase(this);this.a=n};AppRealtimeChannel.O.prototype={a:null};AppRealtimeChannel.F=function(n,t,i,r){AppRealtimeChannel.F.initializeBase(this);this.a=n;this.b=t;this.c=i;this.d=r};AppRealtimeChannel.F.prototype={a:null,b:0,c:null,d:!1};AppRealtimeChannel.K=function(n,t){AppRealtimeChannel.K.initializeBase(this);this.a=n;this.b=t};AppRealtimeChannel.K.prototype={a:!1,b:!1};AppRealtimeChannel.H=function(n,t){AppRealtimeChannel.H.initializeBase(this);this.b=n;this.a=t};AppRealtimeChannel.H.prototype={b:0,a:null};AppRealtimeChannel.y=function(n){AppRealtimeChannel.y.initializeBase(this);this.a=n};AppRealtimeChannel.y.prototype={a:null};AppRealtimeChannel.I=function(n,t,i,r,u,f,e,o,s,h){this.t=Function.createDelegate(this,this.O);this.q=Function.createDelegate(this,this.L);this.r=Function.createDelegate(this,this.w);this.s=Function.createDelegate(this,this.N);this.J=Function.createDelegate(this,this.bc);this.E=Function.createDelegate(this,this.T);this.F=Function.createDelegate(this,this.U);this.H=Function.createDelegate(this,this.W);this.G=Function.createDelegate(this,this.V);this.K=Function.createDelegate(this,this.P);this.I=Function.createDelegate(this,this.Y);this.p=new($$sc.r.$$(AppRealtimeChannel.j,Object));AppRealtimeChannel.I.initializeBase(this,[e]);this.h=n;this.n=0;this.o=0;this.i=t;this.i.a(this.A);this.m=i;this.v=u;this.a.p(this.z);this.a.n(this.I);this.a.s(this.K);this.a.k(this.G);this.a.l(this.H);this.a.j(this.F);this.a.i(this.E);this.a.r(this.J);this.k=f;this.d=r;this.c=o;this.b=s;this.j=h};AppRealtimeChannel.I.prototype={h:null,e:null,n:0,o:0,u:!1,m:null,v:null,k:null,l:0,d:null,c:null,b:null,j:0,C:function(n,t){this.e=this.v(t.a);this.i.d();this.e.c(this.s);this.e.b(this.r);this.e.a(this.q);this.e.d(this.t)},B:function(n,t){this.g=t.a;t.a===2&&this.bb()},bb:function(){for(var t=this.p.$$ge(),n;t.$$mn();)n=t.$$cu(),this.P(null,new AppRealtimeChannel.u(n.b,n.a,!1,new($$sc.D.$$(Object))));this.p=new($$sc.r.$$(AppRealtimeChannel.j,Object))},Y:function(n,t){t.e();for(var i=0;i<2;++i)this.ba(i,t)},ba:function(n,t){try{var i=this,r=this,f=this;this.e.i(n).done(function(r){t.d(t.a,"GetCompletePresenceSuccess")&&(t.f.c(),Diag.a.a(3249540,500,50,"Successfully retrieved complete session state for [{0}]",i.d),i.a.E(),i.X(n,r),i.a.x(r),t.b.c(n)&&i.a.g(n,t.b.b(n),new($$sc.D.$$(Object))))}).fail(function(n){t.d(t.a,"GetCompletePresenceFail")&&(Diag.a.a(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",AppRealtimeChannel.c.a(n),r.d),r.a.a(null))}).always(function(){t.c&&t.c.a()})}catch(u){Diag.a.a(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",t.a,u.message)}},bc:function(n,t){var e=t.b,o,r=t.c,u,i,f,y;this.b.a(1,0);try{o=AppRealtimeChannel.c.b(e,this.j)}catch(s){this.b.a(1,3);Diag.a.a(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",s.message);r.SX(s);return}if(u=new($$sc.w.$$(Common.PresenceDataEntryForClients)),u.a(this.m,(i=new Common.PresenceDataEntryForClients,i.Presence=e,i.TimeStamp=(new Date).getTime(),i)),this.a.h(t.a,u),this.g!==2){this.c.a();this.b.a(1,2);r.b(null);return}f=this.l.toString();++this.l;var c=this,l=new AppRealtimeChannel.r(function(){return c.bd(t.a,o,f)},f),a=this.Q(0,t.a),h=a.b(l),v=this;h.c(function(n){n===2&&v.b.a(1,6);r.b(null)});y=this;h.b(function(){})},bd:function(n,t,i){var o=null,f=new AppRealtimeChannel.v,r=new AppRealtimeChannel.i;if(Diag.a.a(3249501,500,50,"Sending presence update for [{0}]",this.d),this.g!==2)return this.c.a(),this.b.a(1,2),Diag.a.a(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.d),r.d(),r;this.k&&this.n<20&&(o=this.k.a("WebServiceCall","Send Presence Message"),this.n++);f.d();r.e(1);try{var u=this,e=this,h=this;this.e.k(n,t).done(function(){u.c.c();u.b.a(1,1);Diag.a.a(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",i,u.d);r.a(1);f&&(f.e(),f.c()>u.h.a()?u.b.a(1,4):u.b.a(1,5))}).fail(function(n){e.f||(e.c.a(),e.b.a(1,3),Diag.a.a(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",i,AppRealtimeChannel.c.a(n),e.d));r.a(2)}).always(function(){o&&o.a()})}catch(s){Diag.a.a(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",s.message);this.b.a(1,3);r.a(2)}return r},P:function(n,t){var i=t.c,f=t.d,h=t.a,r=t.b,e,u,y;this.b.a(0,0);try{e=AppRealtimeChannel.c.b(f,this.j)}catch(o){this.b.a(0,3);Diag.a.a(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",o.message);r.SX(o);return}if(this.g!==2){h?this.p.a(i,f):(this.c.a(),this.b.a(0,2));r.b(null);return}u=this.l.toString();++this.l;var c=this,l=new AppRealtimeChannel.r(function(){return c.be(i,e,u)},u),a=this.Q(1,i),s=a.b(l),v=this;s.c(function(n){n===2&&v.b.a(0,6);r.b(null)});y=this;s.b(function(){})},be:function(n,t,i){var o=null,f=new AppRealtimeChannel.v,r=new AppRealtimeChannel.i;if(Diag.a.a(3249505,500,50,"Sending update notification for [{0}]",this.d),this.g!==2)return this.c.a(),this.b.a(0,2),Diag.a.a(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.d),r.d(),r;this.k&&n===3&&this.o<20&&(o=this.k.a("WebServiceCall","Send WetContent Update"),this.o++);f.d();r.e(1);var u=this,e=this,s=this;return this.e.j(n,t).done(function(){u.c.c();u.b.a(0,1);Diag.a.a(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",i,u.d);r.a(1);f&&(f.e(),f.c()>u.h.a()?u.b.a(0,4):u.b.a(0,5))}).fail(function(n){e.f||(e.c.a(),e.b.a(0,3),Diag.a.a(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",i,AppRealtimeChannel.c.a(n),e.d));r.a(2)}).always(function(){o&&o.a()}),r},D:function(){this.e.g(this.s);this.e.f(this.r);this.e.e(this.q);this.e.h(this.t)},V:function(n,t){this.N(t.b,t.a)},N:function(n){this.c.b();this.w(0,n)},U:function(n,t){this.w(t.a,t.b)},X:function(n,t){var u={},f=t,i,r;for(i in f)r={key:i,value:f[i]},u[r.key]=r.value.Presence;this.M(n,u,t)},w:function(n,t){this.c.b();this.M(n,t,null)},M:function(n,t,i){var e,o,w,s,h,c,l,a,r,v,u,f;if(Diag.a.f(500,100)){e=t;for(o in e)w={key:o,value:e[o]}}if(delete t[this.m],!Common.H.a(t)){s=t;for(h in s)c={key:h,value:s[h]},l=c.key,t[l]=AppRealtimeChannel.c.c(c.value,"Presence",l,!1,this.j);var y=new($$sc.w.$$(Common.PresenceDataEntryForClients)),b=(new Date).getTime(),p=t;for(a in p)r={key:a,value:p[a]},v=r.key,i?(u=i[v],u.Presence=r.value):u=(f=new Common.PresenceDataEntryForClients,f.Presence=r.value,f.TimeStamp=b,f),y.a(v,u);this.a.h(n,y);n?this.a.B(n,t):(this.u||(Diag.a.a(4539734,500,50,"Raising first presence update notification for [{0}]",this.d),this.u=!0,Common.a.f&&(Common.a.f.IsCoauthSession=!0)),this.a.e(t,new Array(0)))}},T:function(n,t){this.L(t.a)},L:function(n){if(this.c.b(),Diag.a.f(500,100))for(var t=0;t<n.length;++t);n.length&&(this.a.H(n),this.a.A(n),this.a.e({},n))},W:function(n,t){this.O(t.a,t.b)},O:function(n,t){var i,r,u;if(this.h.o()&&!n&&Diag.a.a(40128990,500,100,"Received ContentUpdate notification from the server"),this.h.p()&&n===13&&Diag.a.a(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",t||"<none>")),this.c.b(),n===5){i=this.Z(t);r=i?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",i.c,i.b):"Received client reconnection request from the server without params.";Diag.a.a(18637071,500,50,r);this.a.a(i);return}u=AppRealtimeChannel.c.c(t,String.format("UpdateNotification-{0}",AppRealtimeChannel.j.toString(n)),null,this.h.j(),this.j);this.a.G(n,u)},Z:function(n){try{if(!n||n==="")return null;var t=JSON.parse(n);return new AppRealtimeChannel.F(t.rr,t.rbp,t.rd,t.sa)}catch(i){return Diag.a.a(593844380,500,15,"Error when parsing reconnect hint: {0}",i.message),null}},Q:function(n,t){return this.i.b(n+","+t)}};AppRealtimeChannel.c=function(){};AppRealtimeChannel.c.b=function(n,t){var i,r,u;try{i=JSON.stringify(n)}catch(f){r=String.format("Failed to JSON-serialize payload : {0}",f);Diag.a.a(18637072,500,10,r);throw Error.argument("payload",r);}if(i.length>t){u=String.format("Payload exceeds maximum length: {0} > {1}.",i.length,t);Diag.a.a(18637074,500,10,u);throw Error.argument("payload",u);}return i};AppRealtimeChannel.c.c=function(n,t,i,r,u){var f,s,e,o,h,c;if(!n)return null;if(Object.getType(n)!==String){if(r)try{f=AppRealtimeChannel.c.b(n,u)}catch(l){f=String.format("Failed to JSON serialize the object with exception [{0}]",l)}else f="not allowed to log the object";return s=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}]. Object: [{3}].",t,Object.getType(n).getName(),i,f),Diag.a.a(18637075,500,10,s),null}e=null;o=n;try{e=JSON.parse(o)}catch(a){h=r?o:"not allowed to log the object";c=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}]. Object: [{3}]",t,a,i,h);Diag.a.a(18637077,500,10,c)}return e};AppRealtimeChannel.c.a=function(n){if(!n)return"";if(String.isInstanceOfType(n))return n.toString();try{return JSON.stringify(n)}catch(t){return n.toString()}};AppRealtimeChannel.c.d=function(n,t,i,r){var u,f,e;if(t.val=0,i.val=null,r.val=null,n)try{u=n;f=u.source;f&&Object.getType(f)===String&&(r.val=f);e=u.context;e&&(u=e,t.val=u.status?u.status:0,i.val=u.statusText?u.statusText:null)}catch(o){}};AppRealtimeChannel.v=function(){};AppRealtimeChannel.v.prototype={a:null,b:null,c:function(){return this.a?this.b?this.b.getTime()-this.a.getTime():(new Date).getTime()-this.a.getTime():0},d:function(){this.a=new Date},e:function(){this.b=new Date}};AppRealtimeChannel.i=function(){this.g=new(AppRealtimeChannel.p.$$(Common.hI));this.f=new(AppRealtimeChannel.p.$$(Common.hH))};AppRealtimeChannel.i.prototype={c:function(n){this.g.f(n)},b:function(n){this.f.f(n)},e:function(n){this.g.e(n)},a:function(n){this.f.e(n)},d:function(){this.e(2);this.a(2)},g:null,f:null};AppRealtimeChannel.p=function(){this.d=this.$$gta["AppRealtimeChannel.p"].T===Number||Type.isEnum(this.$$gta["AppRealtimeChannel.p"].T)?0:this.$$gta["AppRealtimeChannel.p"].T===Boolean?!1:null};AppRealtimeChannel.p.$$=function(n){var u=AppRealtimeChannel.__tc=AppRealtimeChannel.__tc||{},t="p$"+n.getName().replace(/\./g,"_"),i,o,f,e,r;if(!u[t]){i=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];AppRealtimeChannel.p.apply(this,t)};i.registerClass("AppRealtimeChannel.__tc."+t);o={"AppRealtimeChannel.p":{T:n},ctor:AppRealtimeChannel.p};i.prototype.$$gta=o;f=AppRealtimeChannel.p.prototype;for(e in f)r={key:e,value:f[e]},"constructor"!==r.key&&(i.prototype[r.key]=r.value)}return u[t]};AppRealtimeChannel.p.prototype={f:function(n){this.a=n;this.g()},e:function(n){this.b||(this.b=!0,this.d=n,this.g())},g:function(){this.b&&this.a&&!this.c&&(this.c=!0,this.a(this.d))},b:!1,c:!1,a:null};AppRealtimeChannel.r=function(n,t){this.b=n;this.c=t};AppRealtimeChannel.r.prototype={a:function(){return this.b()},c:null,b:null};AppRealtimeChannel.L=function(n,t){this.y=n;this.x=t;this.s=AppRealtimeChannel.L.a;this.h=this.o=this.n=0};AppRealtimeChannel.L.a=function(n,t){return window.setTimeout(n,t)};AppRealtimeChannel.L.prototype={h:0,o:0,n:0,c:function(){this.h>0&&this.n>0&&Diag.a.a(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.x,this.n,this.h);this.h>0&&this.o>0&&Diag.a.a(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.x,this.o,this.h)},y:null,g:!1,t:null,k:null,j:!1,x:null,s:null,z:function(n,t){this.o++;this.u(!0);this.g=!0;this.t=n;this.k=t},u:function(n){this.g=!1;this.k&&n&&(this.n++,this.k.d());this.t=null;this.k=null}};AppRealtimeChannel.q=function(n,t){this.l=Function.createDelegate(this,this.p);AppRealtimeChannel.q.initializeBase(this,[n,t]);this.e=new Date(0).getTime();var i=this;this.f=function(){return(new Date).getTime()}};AppRealtimeChannel.q.a=function(n,t){return new AppRealtimeChannel.q(n,t)};AppRealtimeChannel.q.prototype={i:0,e:0,f:null,d:function(n){this.j||(this.i=n,this.j=!0)},b:function(n){this.j||this.d(200);this.h++;var t=this.f(),i=new AppRealtimeChannel.i;return this.e>t&&(this.e=t),this.g?(this.u(!0),this.z(n,i)):this.e+this.i<=t?this.m(n,i):(this.z(n,i),this.s(this.l,this.e+this.i-t)),i},p:function(){if(this.g){var n=this.t,t=this.k;this.u(!1);this.m(n,t)}},m:function(n,t){var i,r,u;this.e=this.f();i=this.y(n);r=this;i.c(function(n){t.e(n)});u=this;i.b(function(n){t.a(n)})}};AppRealtimeChannel.l=function(n,t){this.D=Function.createDelegate(this,this.I);this.C=Function.createDelegate(this,this.G);this.A=new Common.bc;AppRealtimeChannel.l.initializeBase(this,[n,t]);this.l=0;this.m=[];this.p=AppRealtimeChannel.l.b};AppRealtimeChannel.l.a=function(n,t){return new AppRealtimeChannel.l(n,t)};AppRealtimeChannel.l.b=function(n){window.clearTimeout(n)};AppRealtimeChannel.l.prototype={B:0,v:0,p:null,l:0,m:null,i:!1,w:0,q:0,r:0,b:function(n){this.j||this.e(15e3,5);this.h++;var t=new AppRealtimeChannel.i;return this.g?this.z(n,t):this.l<this.v?this.E(n,t):(this.z(n,t),this.i=!1),t},E:function(n,t){var u=this.y(n),f=this.s(this.C,this.B),i,e,r;++this.l;Array.add(this.m,f);i=this.q;e=this;u.c(function(n){t.e(n)});r=this;u.b(function(n){r.q===i&&(r.F(i,f),t.a(n))})},F:function(n,t){this.q===n&&(--this.l,this.p(t),Array.remove(this.m,t),this.g&&this.H())},H:function(){this.g&&(this.i||(this.w=this.s(this.D,0),this.i=!0))},I:function(){if(this.i=!1,this.g){var n=this.t,t=this.k;this.u(!1);this.E(n,t)}},G:function(){++this.r;var n=Math.floor(this.v/2);this.r>n&&(this.r=-1e9,this.A.k("TMUDM",null,null))},d:function(n){this.A.m("TMUDM",n)},f:function(){var i;this.r=0;this.h=this.o=this.n=0;++this.q;for(var t=this.m,r=t.length,n=0;n<r;++n)i=t[n],this.p(i);this.l=0;this.m=[];this.u(!0);this.i&&(this.p(this.w),this.w=0,this.i=!1)},e:function(n,t){this.j||(this.B=n,this.v=t,this.j=!0)}};AppRealtimeChannel.M=function(){};AppRealtimeChannel.M.prototype={a:function(n,t){return AppRealtimeChannel.l.a(n,t)},b:function(n,t){return AppRealtimeChannel.q.a(n,t)}};AppRealtimeChannel.N=function(n){var i,t;this.j=new Common.bc;this.h=new($$sc.w.$$(AppRealtimeChannel.A));this.g=new($$sc.w.$$(AppRealtimeChannel.z));this.i=n;i=this;this.e=this.i.a(function(n){return n.a()},"GlobalMaxOustandingThrottler");t=this;this.e.d(function(){t.j.k("TMUDM",null,null)})};AppRealtimeChannel.N.prototype={i:null,h:null,g:null,e:null,f:null,k:!1,c:function(n){this.k||(this.f=n,this.e.e(this.f.a,this.f.b),this.k=!0)},b:function(n){var i,f,e,t,o,s,h,r,c,l,u;return this.k||this.c(new AppRealtimeChannel.w(200,15e3,5,1e3)),(e=this.h.f(n,f={val:i},null),i=f.val,e)||((s=this.g.f(n,o={val:t},null),t=o.val,s)||(h="MaxOutstandingThrottler-"+n,r=this.e,t=this.i.a(r.a||(r.a=Function.createDelegate(r,r.b)),h),t.e(this.f.a,this.f.c),c=this,t.d(function(){c.j.k("TMUDM",null,null)}),this.g.g(n,t)),l="MaxRateThrottler-"+n,u=t,i=this.i.b(u.a||(u.a=Function.createDelegate(u,u.b)),l),i.d(this.f.d),this.h.g(n,i)),i},d:function(){for(var i=this.h.$$ge(),r,n,t;i.$$mn();)r=i.$$cu(),r.a.c();for(n=this.g.$$ge();n.$$mn();)t=n.$$cu(),t.a.c(),t.a.f();this.e.c();this.e.f()},a:function(n){this.j.m("TMUDM",n)}};AppRealtimeChannel.w=function(n,t,i,r){this.d=n;this.a=t;this.c=i;this.b=r};AppRealtimeChannel.w.prototype={d:0,a:0,c:0,b:0};AppRealtimeChannel.b=function(){this.g=0;this.e=this.k(6);this.c=this.k(6);this.b=0;this.a=0;var n=this;this.f=function(){return new Date}};AppRealtimeChannel.b.a=function(){return AppRealtimeChannel.b.b||(AppRealtimeChannel.b.b=new AppRealtimeChannel.b),AppRealtimeChannel.b.b};AppRealtimeChannel.b.prototype={i:!1,h:null,e:null,c:null,b:0,a:0,g:0,f:null,k:function(n){for(var t=new Array(n),i=0;i<t.length;i++)t[i]=0;return t},m:function(){return this.e.toString()},l:function(){return this.c.toString()},n:function(){this.h=this.f()},d:function(n,t,i){if(!this.i){i&&(this.i=!0);var r=this.f();!n&&this.b>5||n===1&&this.a>5||(this.g<n?(this.b%2==1&&(this.e[this.b]=-1,this.b++),this.g=n,t===1&&(this.c[this.a]=-1,this.a++),this.c[this.a]=this.j(r),this.a++):n?(this.c[this.a]=this.j(r),this.a++):(this.e[this.b]=this.j(r),this.b++))}},j:function(n){var t=n.getTime()-this.h.getTime();return this.h=n,t}};AppRealtimeChannel.e=function(n,t,i){this.i=Function.createDelegate(this,this.m);this.h=Function.createDelegate(this,this.l);this.c=t;this.f=i;this.b=!1;this.d=n;this.d.d(this.h)};AppRealtimeChannel.e.b=function(n,t,i){return AppRealtimeChannel.e.a||(AppRealtimeChannel.e.a=new AppRealtimeChannel.e(n,t,i))};AppRealtimeChannel.e.prototype={d:null,f:!1,b:!1,a:null,g:0,c:null,e:0,n:function(){if(this.f&&!this.b){var n=this.c.d();if(this.e=this.c.b(),n<=this.e){Diag.a.a(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.c.d(),this.c.b());this.f=!1;return}this.b=!0;this.g=window.setInterval(this.i,n)}},m:function(){var n,t;this.b&&(n=Common.bw.a().toString(),this.a=new AppRealtimeChannel.B(n),this.d.c(16,n,!1,new($$sc.D.$$(Object))),t=this,window.setTimeout(function(){t.j(n)},this.e))},j:function(n){if(this.a&&this.a.b===n){if(this.a.a.f.length>0){var t=this.a.a.g().join(",");Diag.a.a(571339719,500,15,"ClientMessageLatencies:[{0}]",t)}else Diag.a.a(562312150,500,50,"No client message latencies recorded");this.a=null}},o:function(){this.g&&(window.clearInterval(this.g),this.b=!1)},l:function(n,t){t.a===16?this.d.c(17,t.b,!1,new($$sc.D.$$(Object))):t.a===17&&this.b&&t.b&&this.k(t.b)},k:function(n){if(n&&this.a&&n.toString()===this.a.b){var t=(new Date).getTime(),i=t-this.a.c;this.a.a.b(i)}}};AppRealtimeChannel.B=function(n){this.b=n;this.c=(new Date).getTime();this.a=new($$sc.v.$$(Number))};AppRealtimeChannel.B.prototype={b:null,c:0,a:null};AppRealtimeChannel.Q.registerClass("AppRealtimeChannel.Q");AppRealtimeChannel.x.registerClass("AppRealtimeChannel.x");AppRealtimeChannel.a.registerClass("AppRealtimeChannel.a");AppRealtimeChannel.n.registerClass("AppRealtimeChannel.n",null,AppRealtimeChannel.d,Common.ej);AppRealtimeChannel.n.b.registerClass("AppRealtimeChannel.n.b");AppRealtimeChannel.J.registerClass("AppRealtimeChannel.J",Sys.EventArgs);AppRealtimeChannel.u.registerClass("AppRealtimeChannel.u",Sys.EventArgs);AppRealtimeChannel.G.registerClass("AppRealtimeChannel.G",Sys.EventArgs);AppRealtimeChannel.E.registerClass("AppRealtimeChannel.E",Sys.EventArgs);AppRealtimeChannel.P.registerClass("AppRealtimeChannel.P",Sys.EventArgs);AppRealtimeChannel.O.registerClass("AppRealtimeChannel.O",Sys.EventArgs);AppRealtimeChannel.F.registerClass("AppRealtimeChannel.F",Sys.EventArgs);AppRealtimeChannel.K.registerClass("AppRealtimeChannel.K",Sys.EventArgs);AppRealtimeChannel.H.registerClass("AppRealtimeChannel.H",Sys.EventArgs);AppRealtimeChannel.y.registerClass("AppRealtimeChannel.y",Sys.EventArgs);AppRealtimeChannel.I.registerClass("AppRealtimeChannel.I",AppRealtimeChannel.Q);AppRealtimeChannel.v.registerClass("AppRealtimeChannel.v");AppRealtimeChannel.i.registerClass("AppRealtimeChannel.i",null,AppRealtimeChannel.U);AppRealtimeChannel.L.registerClass("AppRealtimeChannel.L");AppRealtimeChannel.q.registerClass("AppRealtimeChannel.q",AppRealtimeChannel.L);AppRealtimeChannel.l.registerClass("AppRealtimeChannel.l",AppRealtimeChannel.L);AppRealtimeChannel.e.registerClass("AppRealtimeChannel.e");AppRealtimeChannel.B.registerClass("AppRealtimeChannel.B");AppRealtimeChannel.a.a=null;AppRealtimeChannel.f.a=null;AppRealtimeChannel.g.a=null;AppRealtimeChannel.b.b=null;AppRealtimeChannel.e.a=null;